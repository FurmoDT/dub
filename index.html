<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.0/dist/bundled/bootstraptemplate/bootstrap.css">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.0/dist/panel.min.js"></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-env>
        - numpy
        - pandas
        - panel==0.13.1a2
        - xlrd
        - ./python_docx-0.8.11-py2.py3-none-any.whl
    </py-env>
</head>

<body>
    <div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
        <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow" id="header"
            style="background-color: #0f54ea;">
            <div class="app-header">
                <a class="title" href="" style="color: #f7f6f3;">PyScript - Python in the Browser</a>
            </div>
        </nav>

        <div class="row overflow-hidden" id="content">
            <div class="col mh-100 float-left" id="main">
                <div id="fileinput"></div>
                <div id="table"></div>
            </div>
        </div>
    </div>
    <py-script>
import asyncio
import panel as pn
import pandas as pd
from panel.io.pyodide import show

from docx import Document
from docx.oxml.ns import qn
import docx

file_input = pn.widgets.FileInput(accept='.xls', width=180)

def process_file():
    if file_input.value is not None:
        df = pd.read_excel(file_input.value, sheet_name=0, engine='xlrd')
        value = df.values.tolist()
        filename_save = file_input.filename.split('.')[0]
        doc = Document()
        style = doc.styles['Normal']
        style.font.size = docx.shared.Pt(10)
        title = doc.add_paragraph()
        run = title.add_run(filename_save)
        run.bold = True
        run.font.size = docx.shared.Pt(16)

        for i in value:
            br = doc.add_paragraph()
            tc_in = doc.add_paragraph()
            source = doc.add_paragraph()
            target = doc.add_paragraph()
            br.add_run('')
            tc_in.add_run(i[1])
            source.add_run(i[3])
            target.add_run(i[4])
    file_stream = io.BytesIO()
    doc.save(file_stream)
    file_stream.seek(0)
    return file_stream
file_download = pn.widgets.FileDownload(filename="data.docx", callback=process_file, button_type="primary")

row = pn.Row(file_input, file_download, height=75)

await show(row, 'fileinput')
await show(table, 'table')
    </py-script>
</body>

</html>
      </py-script>
  </body>
</html>
